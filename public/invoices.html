<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>–°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤</title>
    <!-- Version: 2.0 - Server-side WhatsApp Integration -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Dropdown Menu Styles */
        .nav-menu {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }

        .menu-button {
            background: white;
            color: #667eea;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-button:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background: white;
            min-width: 220px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            border-radius: 8px;
            z-index: 1000;
            margin-top: 5px;
            overflow: hidden;
        }

        .dropdown-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-content a {
            color: #333;
            padding: 14px 20px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .dropdown-content a:hover {
            background: #f8f9fa;
            border-left-color: #667eea;
        }

        .dropdown-content a.active {
            background: #e3f2fd;
            border-left-color: #667eea;
            font-weight: 600;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stat-card h3 {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .stat-card.total .value { color: #667eea; }
        .stat-card.paid .value { color: #4CAF50; }
        .stat-card.unpaid .value { color: #ff4757; }

        .table-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h2 {
            font-size: 1.5em;
            color: #333;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e1e8ed;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e1e8ed;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-block;
        }

        .status-paid {
            background: #d4edda;
            color: #155724;
        }

        .status-unpaid {
            background: #f8d7da;
            color: #721c24;
        }

        .toggle-payment {
            cursor: pointer;
            user-select: none;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-view {
            background: #2196F3;
            color: white;
        }

        .action-view:hover {
            background: #0b7dda;
        }

        .action-whatsapp {
            background: #25D366;
            color: white;
        }

        .action-whatsapp:hover {
            background: #128C7E;
        }

        .action-edit {
            background: #FFA726;
            color: white;
        }

        .action-edit:hover {
            background: #FB8C00;
        }

        .action-delete {
            background: #ff4757;
            color: white;
        }

        .action-delete:hover {
            background: #ff3838;
        }

        .action-autosend {
            background: #9C27B0;
            color: white;
        }

        .action-autosend:hover {
            background: #7B1FA2;
        }

        .action-autosend.enabled {
            background: #4CAF50;
        }

        .action-autosend.enabled:hover {
            background: #45a049;
        }

        .action-duplicate {
            background: #00BCD4;
            color: white;
        }

        .action-duplicate:hover {
            background: #0097A7;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideUp 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input[type="date"],
        .form-group input[type="checkbox"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
            font-size: 14px;
        }

        .form-group input[type="checkbox"] {
            width: auto;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #e1e8ed;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d1d8dd;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 1024px) {
            .actions {
                flex-wrap: wrap;
                gap: 5px;
            }

            .action-btn {
                font-size: 0.75em;
                padding: 5px 8px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 0;
            }

            .header {
                padding: 15px;
                flex-direction: column;
                gap: 10px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .menu-button {
                width: 100%;
                justify-content: center;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-card h3 {
                font-size: 0.9em;
            }

            .stat-card .value {
                font-size: 1.3em;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                font-size: 0.75em;
                min-width: 600px;
            }

            th, td {
                padding: 8px 4px;
            }

            .actions {
                flex-direction: column;
                gap: 3px;
            }

            .action-btn {
                width: 100%;
                font-size: 0.75em;
                padding: 6px 8px;
                white-space: nowrap;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
                margin: 10px;
            }

            .modal-header {
                font-size: 1.2em;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.3em;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.7em;
            }

            th, td {
                padding: 6px 3px;
            }

            .status-badge {
                font-size: 0.7em;
                padding: 4px 8px;
            }

            .action-btn {
                font-size: 0.7em;
                padding: 5px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Dropdown Navigation Menu -->
        <div class="nav-menu">
            <button class="menu-button" onclick="toggleMenu()">
                ‚ò∞ –ú–µ–Ω—é
            </button>
            <div class="dropdown-content" id="dropdownMenu">
                <a href="/">üìÑ –°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç</a>
                <a href="/invoices" class="active">üìä –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤</a>
                <a href="/clients">üë• –ö–ª–∏–µ–Ω—Ç—ã</a>
                <a href="/warehouse">üì¶ –°–∫–ª–∞–¥</a>
                <a href="/analytics">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                <a href="/settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            </div>
        </div>

        <div class="header">
            <div class="header-content">
                <h1>üìä –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤</h1>
                <a href="/" class="btn btn-primary">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç</a>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card total">
                <h3>–í—Å–µ–≥–æ —Å—á–µ—Ç–æ–≤</h3>
                <div class="value" id="statTotal">0</div>
            </div>
            <div class="stat-card paid">
                <h3>–û–ø–ª–∞—á–µ–Ω–æ</h3>
                <div class="value" id="statPaid">0</div>
            </div>
            <div class="stat-card unpaid">
                <h3>–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ</h3>
                <div class="value" id="statUnpaid">0</div>
            </div>
            <div class="stat-card total">
                <h3>–û–±—â–∞—è —Å—É–º–º–∞</h3>
                <div class="value" id="statTotalAmount">0‚ÇΩ</div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h2>–í—Å–µ —Å—á–µ—Ç–∞</h2>
            </div>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>

            <div id="content" style="display: none;">
                <table id="invoicesTable">
                    <thead>
                        <tr>
                            <th>‚Ññ –°—á–µ—Ç–∞</th>
                            <th>–ö–ª–∏–µ–Ω—Ç</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>

                <div id="emptyState" class="empty-state" style="display: none;">
                    <h3>üìÑ –ù–µ—Ç —Å—á–µ—Ç–æ–≤</h3>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —Å—á–µ—Ç!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Auto-Send Settings -->
    <div id="autoSendModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∞—Å—Å—ã–ª–∫–∏
            </div>
            <div class="modal-body">
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="autoSendEnabled">
                    <label for="autoSendEnabled">–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–∞—Å—Å—ã–ª–∫—É</label>
                </div>
                <div class="form-group">
                    <label for="nextSendDate">–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π —Ä–∞—Å—Å—ã–ª–∫–∏:</label>
                    <input type="date" id="nextSendDate">
                </div>
                <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                    üìÖ –°—á–µ—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∫–ª–∏–µ–Ω—Ç—É –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É.<br>
                    ‚è∞ –ú–µ–∂–¥—É —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏ —Ä–∞–∑–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª 10 –º–∏–Ω—É—Ç.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAutoSendModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveAutoSendSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // Toggle dropdown menu
        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('show');
        }

        // Close menu when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.menu-button')) {
                const menu = document.getElementById('dropdownMenu');
                if (menu.classList.contains('show')) {
                    menu.classList.remove('show');
                }
            }
        }

        async function loadInvoices() {
            try {
                const response = await fetch('/api/invoices/list');
                const data = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('statTotal').textContent = data.statistics.total;
                document.getElementById('statPaid').textContent = data.statistics.paid;
                document.getElementById('statUnpaid').textContent = data.statistics.unpaid;
                document.getElementById('statTotalAmount').textContent = formatMoney(data.statistics.totalAmount);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';

                if (data.invoices.length === 0) {
                    document.getElementById('invoicesTable').style.display = 'none';
                    document.getElementById('emptyState').style.display = 'block';
                } else {
                    renderInvoices(data.invoices);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—á–µ—Ç–æ–≤');
            }
        }

        function renderInvoices(invoices) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            invoices.forEach(invoice => {
                const tr = document.createElement('tr');

                const statusBadge = invoice.paid
                    ? '<span class="status-badge status-paid">‚úì –û–ø–ª–∞—á–µ–Ω</span>'
                    : '<span class="status-badge status-unpaid">‚úó –ù–µ –æ–ø–ª–∞—á–µ–Ω</span>';

                const recurringBadge = invoice.isRecurring ? ' <span style="background: #e3f2fd; color: #1976d2; padding: 2px 6px; border-radius: 4px; font-size: 0.75em;">üîÑ –ê–±–æ–Ω–µ–º–µ–Ω—Ç</span>' : '';
                const autoSendBadge = invoice.autoSendEnabled ? ' <span style="background: #e8f5e9; color: #2e7d32; padding: 2px 6px; border-radius: 4px; font-size: 0.75em;">üìÖ –ê–≤—Ç–æ—Ä–∞—Å—Å—ã–ª–∫–∞</span>' : '';
                const autoSendClass = invoice.autoSendEnabled ? 'enabled' : '';
                const autoSendText = invoice.autoSendEnabled ? 'üìÖ –ê–≤—Ç–æ—Ä–∞—Å—Å—ã–ª–∫–∞' : 'üìÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å';

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤
                const duplicateButton = invoice.paid
                    ? '<button class="action-btn action-duplicate" onclick="duplicateInvoice(\''+invoice.id+'\')">üìã –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å</button>'
                    : '';

                tr.innerHTML = `
                    <td><strong>#${invoice.invoiceNumber}</strong>${recurringBadge}${autoSendBadge}</td>
                    <td>${invoice.client || '<span style="color: #999;">–ù–µ —É–∫–∞–∑–∞–Ω</span>'}</td>
                    <td>${formatDate(invoice.createdAt)}</td>
                    <td><strong>${formatMoney(invoice.amount)}</strong></td>
                    <td class="toggle-payment" onclick="togglePayment('${invoice.id}', ${!invoice.paid})">${statusBadge}</td>
                    <td>
                        <div class="actions">
                            <button class="action-btn action-view" onclick="viewInvoice('${invoice.filename}')">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                            <button class="action-btn action-whatsapp" data-invoice-id="${invoice.id}" data-invoice-number="${invoice.invoiceNumber}" data-client-name="${invoice.client}" data-client-phone="${invoice.clientPhone || ''}">üì± WhatsApp</button>
                            ${duplicateButton}
                            <button class="action-btn action-autosend ${autoSendClass}" onclick="openAutoSendModal('${invoice.id}')">${autoSendText}</button>
                            <button class="action-btn action-edit" onclick="editInvoice('${invoice.id}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="action-btn action-delete" onclick="deleteInvoice('${invoice.id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </td>
                `;

                tbody.appendChild(tr);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ WhatsApp
            document.querySelectorAll('.action-whatsapp').forEach(btn => {
                btn.addEventListener('click', function() {
                    const invoiceId = this.dataset.invoiceId;
                    const invoiceNumber = this.dataset.invoiceNumber;
                    const clientName = this.dataset.clientName;
                    const clientPhone = this.dataset.clientPhone;
                    sendWhatsApp(invoiceId, invoiceNumber, clientName, clientPhone);
                });
            });
        }

        async function togglePayment(id, paid) {
            try {
                const response = await fetch(`/api/invoices/${id}/payment`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ paid })
                });

                if (response.ok) {
                    const result = await response.json();

                    // –ï—Å–ª–∏ –±—ã–ª —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å—á–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    if (result.newInvoice) {
                        showNotification(
                            '‚úÖ –°—á–µ—Ç –æ–ø–ª–∞—á–µ–Ω!',
                            `–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å—á–µ—Ç ‚Ññ${result.newInvoice.invoiceNumber} –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü —Å –∞–≤—Ç–æ—Ä–∞—Å—Å—ã–ª–∫–æ–π`
                        );
                    }

                    loadInvoices(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞');
            }
        }

        function viewInvoice(filename) {
            window.open(`/view/${filename}`, '_blank');
        }

        function editInvoice(id) {
            window.location.href = `/?edit=${id}`;
        }

        async function deleteInvoice(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å—á–µ—Ç?')) return;

            try {
                const response = await fetch(`/api/invoices/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    loadInvoices(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            }
        }

        async function duplicateInvoice(id) {
            if (!confirm('–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ? –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Å—á–µ—Ç —Å —Ç–µ–º –∂–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º, –Ω–æ –Ω–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º.')) return;

            try {
                showNotification('‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ...', '–î—É–±–ª–∏—Ä—É–µ–º —Å—á–µ—Ç...');

                const response = await fetch(`/api/invoices/${id}/duplicate`, {
                    method: 'POST'
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showNotification('‚úÖ –°–æ–∑–¥–∞–Ω–æ!', result.message);
                    loadInvoices(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    alert('–û—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å—á–µ—Ç–∞');
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatMoney(amount) {
            return amount.toLocaleString('ru-RU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }) + ' ‚ÇΩ';
        }

        // Auto-send modal functions
        let currentAutoSendInvoiceId = null;

        async function openAutoSendModal(invoiceId) {
            currentAutoSendInvoiceId = invoiceId;

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—á–µ—Ç–∞
            try {
                const response = await fetch(`/api/invoices/${invoiceId}`);
                const data = await response.json();

                if (data.success) {
                    const invoice = data.invoice;

                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
                    document.getElementById('autoSendEnabled').checked = invoice.autoSendEnabled || false;

                    if (invoice.nextSendDate) {
                        const date = new Date(invoice.nextSendDate);
                        document.getElementById('nextSendDate').value = date.toISOString().split('T')[0];
                    } else {
                        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü, –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ
                        const nextMonth = new Date();
                        nextMonth.setMonth(nextMonth.getMonth() + 1);
                        nextMonth.setDate(1);
                        document.getElementById('nextSendDate').value = nextMonth.toISOString().split('T')[0];
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å—á–µ—Ç–∞:', error);
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('autoSendModal').classList.add('show');
        }

        function closeAutoSendModal() {
            document.getElementById('autoSendModal').classList.remove('show');
            currentAutoSendInvoiceId = null;
        }

        async function saveAutoSendSettings() {
            if (!currentAutoSendInvoiceId) return;

            const enabled = document.getElementById('autoSendEnabled').checked;
            const nextSendDate = document.getElementById('nextSendDate').value;

            if (enabled && !nextSendDate) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É —Å–ª–µ–¥—É—é—â–µ–π —Ä–∞—Å—Å—ã–ª–∫–∏');
                return;
            }

            try {
                const response = await fetch(`/api/invoices/${currentAutoSendInvoiceId}/auto-send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        enabled,
                        nextSendDate: nextSendDate ? new Date(nextSendDate).toISOString() : null
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã',
                        enabled ? '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞' : '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞');
                    closeAutoSendModal();
                    loadInvoices(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫');
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('autoSendModal');
            if (event.target === modal) {
                closeAutoSendModal();
            }
        });

        async function sendWhatsApp(invoiceId, invoiceNumber, clientName, clientPhone) {
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            let phone = clientPhone.replace(/[^0-9]/g, '');
            if (phone.startsWith('8')) {
                phone = '7' + phone.substring(1);
            }
            if (!phone.startsWith('7')) {
                phone = '7' + phone;
            }

            if (!phone || phone === '7') {
                alert('‚ùå –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å—á–µ—Ç –∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.');
                return;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —à–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            const settings = JSON.parse(localStorage.getItem('whatsappMessageSettings') || '{}');
            const defaultMessage = '–î–æ–±—Ä—ã–π –¥–µ–Ω—å!\n\n–í—ã—Å—ã–ª–∞—é —Å—á–µ—Ç ‚Ññ{–Ω–æ–º–µ—Ä} –Ω–∞ –æ–ø–ª–∞—Ç—É.\n\n–° —É–≤–∞–∂–µ–Ω–∏–µ–º.';
            const messageTemplate = settings.greeting || defaultMessage;

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –∑–∞–º–µ–Ω—è—è {–Ω–æ–º–µ—Ä} –Ω–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞
            const message = messageTemplate.replace('{–Ω–æ–º–µ—Ä}', invoiceNumber);

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é WhatsApp –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞
            try {
                console.log('[WhatsApp] –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–∞–π–ª–∞ –¥–ª—è —Å—á–µ—Ç–∞ ‚Ññ' + invoiceNumber);
                console.log('[WhatsApp] –¢–µ–ª–µ—Ñ–æ–Ω:', phone);
                console.log('[WhatsApp] –°–æ–æ–±—â–µ–Ω–∏–µ:', message);

                showNotification('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞...', `–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—á–µ—Ç –∫–ª–∏–µ–Ω—Ç—É ${clientName} —á–µ—Ä–µ–∑ WhatsApp`);

                const response = await fetch('/api/whatsapp/send-file', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone,
                        message,
                        invoiceId: invoiceNumber  // –ü–µ—Ä–µ–¥–∞–µ–º –Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞, –∞ –Ω–µ timestamp
                    })
                });

                console.log('[WhatsApp] –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞. Status:', response.status);

                let result;
                try {
                    const text = await response.text();
                    console.log('[WhatsApp] –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', text);

                    if (text) {
                        result = JSON.parse(text);
                        console.log('[WhatsApp] –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', result);
                    } else {
                        result = { error: '–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç' };
                    }
                } catch (parseError) {
                    console.error('[WhatsApp] –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞:', parseError);
                    console.error('[WhatsApp] –¢–µ–∫—Å—Ç –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å:', text);
                    result = { error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞' };
                }

                if (response.ok && result.success) {
                    showNotification('‚úÖ –°—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!', `PDF —Ñ–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç—É ${clientName} —á–µ—Ä–µ–∑ WhatsApp`);
                    return;
                } else {
                    const errorMsg = result.error || 'WhatsApp –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω';
                    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:', errorMsg);
                    alert(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ WhatsApp:\n\n${errorMsg}\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.`);
                    return;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:', error);
                alert(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É WhatsApp:\n\n${error.message}\n\n–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.`);
                return;
            }

            // Fallback: –æ—Ç–∫—Ä—ã–≤–∞–µ–º WhatsApp Web –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ —Å iframe
            console.log('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ iframe');
            const whatsappUrl = `https://web.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(message)}`;

            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —Å about:blank —Å–Ω–∞—á–∞–ª–∞
            const whatsappWindow = window.open('about:blank', 'whatsapp', 'width=1400,height=900,scrollbars=yes,resizable=yes');

            if (!whatsappWindow) {
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É
                const link = document.createElement('a');
                link.href = whatsappUrl;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showNotification('‚úÖ WhatsApp –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è...', `–ß–∞—Ç —Å ${clientName} –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ`);
                return;
            }

            whatsappWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>WhatsApp - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—á–µ—Ç–∞ ‚Ññ${invoiceNumber}</title>
                    <style>
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            height: 100vh;
                            display: flex;
                            flex-direction: column;
                            background: #f0f0f0;
                        }
                        .header {
                            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
                            color: white;
                            padding: 15px 20px;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        }
                        .header h2 {
                            font-size: 1.3em;
                            font-weight: 500;
                        }
                        .header button {
                            background: rgba(255,255,255,0.2);
                            border: 2px solid white;
                            color: white;
                            padding: 8px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-size: 16px;
                            font-weight: 600;
                            transition: all 0.3s;
                        }
                        .header button:hover {
                            background: white;
                            color: #25D366;
                        }
                        .info-box {
                            background: white;
                            margin: 15px;
                            padding: 20px;
                            border-radius: 10px;
                            border-left: 4px solid #25D366;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        }
                        .info-box h3 {
                            color: #128C7E;
                            margin-bottom: 10px;
                            font-size: 1.1em;
                        }
                        .info-box ol {
                            margin-left: 20px;
                            line-height: 1.8;
                            color: #555;
                        }
                        .iframe-container {
                            flex: 1;
                            margin: 0 15px 15px 15px;
                            background: white;
                            border-radius: 10px;
                            overflow: hidden;
                            box-shadow: 0 2px 15px rgba(0,0,0,0.15);
                            position: relative;
                        }
                        .loading {
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            text-align: center;
                            z-index: 1;
                        }
                        .spinner {
                            border: 4px solid #f3f3f3;
                            border-top: 4px solid #25D366;
                            border-radius: 50%;
                            width: 50px;
                            height: 50px;
                            animation: spin 1s linear infinite;
                            margin: 0 auto 15px;
                        }
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                        iframe {
                            width: 100%;
                            height: 100%;
                            border: none;
                            display: block;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>üì± WhatsApp Web - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—á–µ—Ç–∞ ‚Ññ${invoiceNumber}</h2>
                        <button onclick="window.close()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                    <div class="info-box">
                        <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h3>
                        <ol>
                            <li>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –≤ WhatsApp –Ω–∞ –≤–∞—à–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ</li>
                            <li>–î–æ–∂–¥–∏—Ç–µ—Å—å –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º: <strong>${clientName}</strong></li>
                            <li>–°–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ</li>
                            <li>–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ PDF-—Ñ–∞–π–ª —Å—á–µ—Ç–∞ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é</li>
                            <li>–ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"</li>
                        </ol>
                    </div>
                    <div class="iframe-container">
                        <div class="loading" id="loading">
                            <div class="spinner"></div>
                            <p style="color: #128C7E; font-weight: 500;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ WhatsApp Web...</p>
                        </div>
                        <iframe
                            src="${whatsappUrl}"
                            allow="camera; microphone; clipboard-read; clipboard-write"
                            onload="document.getElementById('loading').style.display='none';"
                        ></iframe>
                    </div>
                </body>
                </html>
            `);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ
            setTimeout(() => {
                showNotification('‚úÖ –°—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!', `WhatsApp Web –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—á–µ—Ç–∞ ‚Ññ${invoiceNumber} –∫–ª–∏–µ–Ω—Ç—É ${clientName}`);
            }, 500);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(title, message) {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 400px;
                animation: slideIn 0.3s ease;
            `;

            notification.innerHTML = `
                <div style="display: flex; align-items: start; gap: 15px;">
                    <div style="font-size: 24px;">üì±</div>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; font-size: 16px; margin-bottom: 5px;">${title}</div>
                        <div style="font-size: 14px; opacity: 0.95;">${message}</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: rgba(255,255,255,0.2);
                        border: none;
                        color: white;
                        font-size: 18px;
                        cursor: pointer;
                        padding: 5px 10px;
                        border-radius: 6px;
                    ">‚úï</button>
                </div>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –∞–Ω–∏–º–∞—Ü–∏–∏
            if (!document.querySelector('#notificationStyle')) {
                const style = document.createElement('style');
                style.id = 'notificationStyle';
                style.textContent = `
                    @keyframes slideIn {
                        from {
                            transform: translateX(400px);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                    @keyframes slideOut {
                        from {
                            transform: translateX(0);
                            opacity: 1;
                        }
                        to {
                            transform: translateX(400px);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(notification);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadInvoices();
    </script>
</body>
</html>
